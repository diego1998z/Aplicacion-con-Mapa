<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urbbis | Gestor de Senales</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"/>
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/map.css">
    <link rel="stylesheet" href="css/dashboard.css">
</head>
<body>
    <div id="loginOverlay">
        <div class="login-layout">
            <div class="login-hero"></div>
            <div class="login-card">
                <img src="src/assets/logo-login.png" class="login-logo" alt="Logo">
                <h2>Acceso</h2>
                <p>Ingresa tu correo y contraseña para continuar</p>
                <form id="formLogin">
                    <label for="inputCorreo">Correo electrónico</label>
                    <input type="email" id="inputCorreo" placeholder="usuario@correo.com" required>
                    <label for="inputClave">Contraseña</label>
                    <input type="password" id="inputClave" placeholder="********" required>
                    <div class="login-actions">
                        <a href="#" class="login-link">¿Contraseña olvidada?</a>
                        <button type="submit" id="btnLogin">Iniciar sesión</button>
                    </div>
                </form>
                <small class="login-hint">Municipal: muni@muni.gob.pe / Muni123! · Visitante: visitante@correo.com / Visitante123</small>
            </div>
        </div>
    </div>

    <div id="dashboardOverlay" class="dashboard-overlay hidden" aria-hidden="true">
        <aside class="dash-sidebar">
            <div class="dash-brand">
                <div class="dash-logo">URBBIS</div>
            </div>

            <div class="dash-user">
                <div class="dash-avatar" aria-hidden="true"><span id="dashAvatarInitials">UR</span></div>
                <div class="dash-user-meta">
                    <div class="dash-welcome">Bienvenido,</div>
                    <div class="dash-name" id="dashUserName">Usuario</div>
                    <div class="dash-email" id="dashUserEmail"></div>
                </div>
            </div>

            <nav class="dash-nav" aria-label="Navegacion principal">
                <button type="button" class="dash-link active" data-dash="dashboard">Dashboard</button>
                <button type="button" class="dash-link" data-dash="mapa">Mapa</button>
                <button type="button" class="dash-link" data-dash="reportes">Reportes</button>
                <button type="button" class="dash-link" data-dash="tareas">Tareas</button>
                <button type="button" class="dash-link" data-dash="config">Configuracion</button>
            </nav>

            <button type="button" id="btnDashLogout" class="dash-logout">Cerrar sesion</button>
        </aside>

        <main class="dash-main">
            <div class="dash-page" data-dash-page="dashboard">
                <div class="dash-top">
                    <div>
                        <div class="dash-entity" id="dashEntity">Entidad: Municipalidad</div>
                        <div class="dash-msg">Hoy es un gran dia para mejorar la seguridad vial.</div>
                    </div>
                </div>

                <div class="dash-title">
                    <h1>Dashboard <span>/ Resumen General</span></h1>
                </div>

                <section class="dash-grid" aria-label="Resumen general">
                    <article class="dash-card dash-card--primary">
                        <div class="dash-card-head">
                            <div class="dash-card-kicker">Estado general de señalizacion</div>
                            <button type="button" class="dash-card-go" data-dash-go="mapa" title="Ir al mapa">↗</button>
                        </div>
                        <div class="dash-card-value"><span id="dashScore">0</span><span class="dash-card-unit">/100</span></div>
                    </article>

                    <article class="dash-card dash-card--secondary">
                        <div class="dash-card-head">
                            <div class="dash-card-kicker">Señales registradas</div>
                            <button type="button" class="dash-card-go" data-dash-go="reportes" title="Ver reportes">↗</button>
                        </div>
                        <div class="dash-card-value"><span id="dashTotalSenales">0</span></div>
                        <div class="dash-card-sub">Activas en tu proyecto</div>
                    </article>

                    <article class="dash-card dash-card--muted">
                        <div class="dash-card-head">
                            <div class="dash-card-kicker">Inversion en señalizacion</div>
                            <button type="button" class="dash-card-go" data-dash-go="reportes" title="Ver detalle">↗</button>
                        </div>
                        <div class="dash-card-sub">Monto:</div>
                        <div class="dash-card-money" id="dashInversion">S/ 0</div>
                        <div class="dash-card-sub">Valor estimado de infraestructura instalada</div>
                    </article>

                    <article class="dash-card dash-card--muted">
                        <div class="dash-card-head">
                            <div class="dash-card-kicker">Señales requieren atencion</div>
                            <button type="button" class="dash-card-go" data-dash-go="reportes" title="Ver pendientes">↗</button>
                        </div>
                        <div class="dash-card-split">
                            <div class="dash-card-big" id="dashAtencion">0</div>
                            <div>
                                <div class="dash-card-sub"><strong>Señales</strong><br>requieren atencion</div>
                                <div class="dash-card-sub">Antiguas o sin señal</div>
                            </div>
                        </div>
                    </article>
                </section>
            </div>

            <div class="dash-page hidden" data-dash-page="tareas">
                <div class="dash-top">
                    <div>
                        <div class="dash-entity">Tareas</div>
                        <div class="dash-msg">Gestion y seguimiento de avisos ciudadanos.</div>
                    </div>
                </div>
                <div class="dash-title">
                    <h1>Tareas <span>/ Avisos ciudadanos</span></h1>
                </div>
                <div class="reporte-card reporte-avisos dash-avisos-expanded">
                    <h3>Avisos Ciudadanos</h3>
                    <div class="reportes-toolbar reportes-toolbar--compact">
                        <input id="filtroAvisoTextoTareas" type="text" placeholder="Buscar aviso...">
                        <select id="filtroAvisoEstadoTareas">
                            <option value="">Todos los estados</option>
                            <option value="pendiente">Pendiente</option>
                            <option value="atendido">Atendido</option>
                        </select>
                        <select id="filtroAvisoOrdenTareas">
                            <option value="antiguos">Mas antiguos primero</option>
                            <option value="recientes">Mas recientes primero</option>
                        </select>
                        <button id="btnLimpiarFiltrosAvisosTareas" type="button" class="btnToolbar">Limpiar</button>
                    </div>
                    <table id="tablaAvisosTareas">
                        <thead>
                            <tr><th>ID</th><th>Region</th><th>Distrito</th><th>Tipo</th><th>Descripcion</th><th>Estado</th><th>Fecha</th><th>Imagen</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <!-- <section class="dash-config" aria-label="Configuracion">
                    <article class="dash-card dash-card--muted dash-config-card">
                        <h3 class="dash-section-title">Cuenta</h3>
                        <div class="dash-form">
                            <label>Nombre</label>
                            <input id="cfgNombre" type="text" placeholder="Tu nombre">
                            <div class="dash-grid-2">
                                <div>
                                    <label>Email</label>
                                    <input id="cfgEmail" type="text" disabled>
                                </div>
                                <div>
                                    <label>Rol</label>
                                    <input id="cfgRol" type="text" disabled>
                                </div>
                            </div>
                            <div class="dash-actions-row">
                                <button id="btnCfgGuardarPerfil" type="button" class="dash-btn">Guardar</button>
                            </div>
                        </div>
                    </article>

                    <article class="dash-card dash-card--muted dash-config-card">
                        <h3 class="dash-section-title">Preferencias</h3>
                        <div class="dash-form">
                            <div class="dash-toggle">
                                <div>
                                    <div class="dash-toggle-title">Tema oscuro</div>
                                    <div class="dash-toggle-sub">Cambia el estilo visual de la interfaz.</div>
                                </div>
                                <label class="switch">
                                    <input id="cfgTemaOscuro" type="checkbox">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="dash-toggle">
                                <div>
                                    <div class="dash-toggle-title">Animaciones</div>
                                    <div class="dash-toggle-sub">Transiciones suaves en mapa y paneles.</div>
                                </div>
                                <label class="switch">
                                    <input id="cfgAnimaciones" type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="dash-toggle">
                                <div>
                                    <div class="dash-toggle-title">Notificaciones</div>
                                    <div class="dash-toggle-sub">Avisos del sistema (proximamente).</div>
                                </div>
                                <label class="switch">
                                    <input id="cfgNotificaciones" type="checkbox">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </article>

                    <article class="dash-card dash-card--muted dash-config-card">
                        <h3 class="dash-section-title">Mapa</h3>
                        <div class="dash-form">
                            <div class="dash-grid-2">
                                <div>
                                    <label>Zoom inicial</label>
                                    <input id="cfgZoomInicial" type="number" min="10" max="19" step="1">
                                </div>
                                <div>
                                    <label>Duracion animacion (s)</label>
                                    <input id="cfgAnimDur" type="number" min="0" max="3" step="0.1">
                                </div>
                            </div>
                            <div class="dash-actions-row">
                                <button id="btnCfgIrALima" type="button" class="dash-btn dash-btn--ghost">Centrar Lima</button>
                            </div>
                        </div>
                    </article>

                    <article class="dash-card dash-card--muted dash-config-card">
                        <h3 class="dash-section-title">Datos</h3>
                        <div class="dash-form">
                            <div class="dash-actions-row">
                                <button id="btnCfgExportar" type="button" class="dash-btn">Exportar JSON</button>
                                <label class="dash-btn dash-btn--ghost dash-file">
                                    Importar JSON
                                    <input id="cfgImportar" type="file" accept="application/json">
                                </label>
                            </div>
                            <div class="dash-help">Incluye senales horizontales, verticales y avisos ciudadanos del navegador.</div>
                        </div>
                    </article>
                </section> -->
                <div class="dash-placeholder">
                    <strong>En construccion</strong>
                    <p>Este modulo te permitira asignar y dar seguimiento a tareas por distrito, tipo de señal y prioridad.</p>
                </div>
            </div>

            <div class="dash-page hidden" data-dash-page="config">
                <div class="dash-top">
                    <div>
                        <div class="dash-entity">Configuracion</div>
                        <div class="dash-msg">Preferencias de cuenta, mapa y datos.</div>
                    </div>
                </div>
                <div class="dash-title">
                    <h1>Configuracion <span>/ Preferencias</span></h1>
                </div>
                <section class="dash-config" aria-label="Configuracion">
                    <article class="dash-card dash-card--muted dash-config-card">
                        <h3 class="dash-section-title">Cuenta</h3>
                        <div class="dash-form">
                            <label>Nombre</label>
                            <input id="cfgNombre" type="text" placeholder="Tu nombre">
                            <div class="dash-grid-2">
                                <div>
                                    <label>Email</label>
                                    <input id="cfgEmail" type="text" disabled>
                                </div>
                                <div>
                                    <label>Rol</label>
                                    <input id="cfgRol" type="text" disabled>
                                </div>
                            </div>
                            <div class="dash-actions-row">
                                <button id="btnCfgGuardarPerfil" type="button" class="dash-btn">Guardar</button>
                            </div>
                        </div>
                    </article>

                    <article class="dash-card dash-card--muted dash-config-card">
                        <h3 class="dash-section-title">Preferencias</h3>
                        <div class="dash-form">
                            <div class="dash-toggle">
                                <div>
                                    <div class="dash-toggle-title">Tema oscuro</div>
                                    <div class="dash-toggle-sub">Cambia el estilo visual de la interfaz.</div>
                                </div>
                                <label class="switch">
                                    <input id="cfgTemaOscuro" type="checkbox">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="dash-toggle">
                                <div>
                                    <div class="dash-toggle-title">Animaciones</div>
                                    <div class="dash-toggle-sub">Transiciones suaves en mapa y paneles.</div>
                                </div>
                                <label class="switch">
                                    <input id="cfgAnimaciones" type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="dash-toggle">
                                <div>
                                    <div class="dash-toggle-title">Notificaciones</div>
                                    <div class="dash-toggle-sub">Avisos del sistema (proximamente).</div>
                                </div>
                                <label class="switch">
                                    <input id="cfgNotificaciones" type="checkbox">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </article>

                    <article class="dash-card dash-card--muted dash-config-card">
                        <h3 class="dash-section-title">Mapa</h3>
                        <div class="dash-form">
                            <div class="dash-grid-2">
                                <div>
                                    <label>Zoom inicial</label>
                                    <input id="cfgZoomInicial" type="number" min="10" max="19" step="1">
                                </div>
                                <div>
                                    <label>Duracion animacion (s)</label>
                                    <input id="cfgAnimDur" type="number" min="0" max="3" step="0.1">
                                </div>
                            </div>
                            <div class="dash-actions-row">
                                <button id="btnCfgIrALima" type="button" class="dash-btn dash-btn--ghost">Centrar Lima</button>
                            </div>
                        </div>
                    </article>

                    <article class="dash-card dash-card--muted dash-config-card">
                        <h3 class="dash-section-title">Datos</h3>
                        <div class="dash-form">
                            <div class="dash-actions-row">
                                <button id="btnCfgExportar" type="button" class="dash-btn">Exportar JSON</button>
                                <label class="dash-btn dash-btn--ghost dash-file">
                                    Importar JSON
                                    <input id="cfgImportar" type="file" accept="application/json">
                                </label>
                            </div>
                            <div class="dash-help">Incluye senales horizontales, verticales y avisos ciudadanos del navegador.</div>
                        </div>
                    </article>
                </section>
                <div class="dash-placeholder">
                    <strong>En construccion</strong>
                    <p>Aqui podras configurar costos por señal, permisos, catálogos de iconos y parametros de reportes.</p>
                </div>
            </div>
        </main>
    </div>

    <header class="topbar">
        <div class="brand">
            <span class="brand-mark">UR</span>
            <div class="brand-text">
                <strong>Urbbis</strong>
                <small>Gestion de senalizacion</small>
            </div>
        </div>
        <div class="mode-switch">
            <button class="tab-mode active" data-mode="horizontal">Senalizacion horizontal</button>
            <button class="tab-mode" data-mode="vertical">Senalizacion vertical</button>
        </div>
        <div class="top-actions">
            <span class="rol-chip" id="chipRol">Rol: Municipal</span>
            <button id="btnToggleRol" class="btnGhost">Cambiar a visitante</button>
            <button id="btnLogout" class="btnGhost">Cerrar sesión</button>
            <button id="btnToggleReportes" class="btnGhost">Ver reportes</button>
            <div class="badge">Panel operativo</div>
        </div>
    </header>

    <div id="mobileSearch" class="mobile-search">
        <input type="text" id="inputBuscarMobile" placeholder="Buscar direccion...">
        <button id="btnBuscarDireccionMobile" class="btnBuscar">Buscar</button>
        <div id="sugerenciasMobile" class="sugerencias"></div>
    </div>

    <aside id="sidebar">
        <div class="sidebar-top">
            <button id="btnMenu" class="icon-btn">≡</button>
        </div>

        <div class="sidebar-content">
            <h2>Busqueda rapida</h2>
            <div class="filtro-block desktop-search">
                <input type="text" id="inputBuscar" placeholder="Buscar por tipo o distrito...">
                <button id="btnBuscarDireccion" class="btnBuscar">Buscar direccion</button>
                <div id="sugerencias" class="sugerencias"></div>
            </div>

            <div class="filtro-block">
                <h3>Region y distrito</h3>
                <select id="selectRegion"></select>
                <select id="selectDistrito"></select>
            </div>

            <button id="btnAplicarFiltros">Aplicar seleccion</button>

            <div class="filtro-block">
                <h3>Estado</h3>
                <div class="estado-buttons">
                    <button class="btnFiltro" data-estado="nueva">Nueva</button>
                    <button class="btnFiltro" data-estado="antigua">Antigua</button>
                    <button class="btnFiltro" data-estado="sin_senal">Sin senal</button>
                    <button id="btnMostrarTodas" class="btnGhost fullwidth">Limpiar filtros</button>
                </div>
            </div>

            <hr>
            <button id="btnUbicacion" class="btnUbicacion">Mi ubicacion</button>
            <button id="btnReportar" class="btnGhost fullwidth">Reportar problema</button>
        </div>
    </aside>
        <button id="btnFloatingFilters" class="floating-fab search" title="Filtros y busqueda"></button>
    <button id="btnFloatingReport" class="floating-fab report" title="Reportes">!</button>
    <button id="btnFloatingLogout" class="floating-fab logout" title="Cerrar sesion"></button>

    <div id="map">
        <div class="legend">
            <div class="legend-title">Estados</div>
            <div class="legend-item"><span class="dot dot-new"></span> Nueva</div>
            <div class="legend-item"><span class="dot dot-bad"></span> Antigua</div>
            <div class="legend-item"><span class="dot dot-missing"></span> Sin senal</div>
        </div>
    </div>

    <section id="reportes" class="hidden">
        <div class="reportes-sheet">
            <div class="sheet-handle"></div>
            <button id="btnCerrarReportes" class="close-reportes">Cerrar</button>
            <div class="reporte-card reporte-horizontal">
                <h3>Reporte Senalizacion Horizontal</h3>
                <table id="tablaHorizontal">
                    <thead>
                        <tr><th>ID</th><th>Tipo</th><th>Nombre</th><th>Estado</th><th>Fecha</th></tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="reporte-card reporte-vertical">
                <h3>Reporte Senalizacion Vertical</h3>
                <table id="tablaVertical">
                    <thead>
                        <tr><th>ID</th><th>Tipo</th><th>Nombre</th><th>Estado</th><th>Fecha</th></tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="reporte-card reporte-avisos">
                <h3>Avisos Ciudadanos</h3>
                <div class="reportes-toolbar">
                    <input id="filtroAvisoTexto" type="text" placeholder="Buscar aviso...">
                    <select id="filtroAvisoTipo">
                        <option value="">Todos los tipos</option>
                        <option value="falta">Falta señal</option>
                        <option value="danada">Señal dañada</option>
                        <option value="obstruida">Obstruida</option>
                        <option value="otro">Otro</option>
                    </select>
                    <select id="filtroAvisoEstado">
                        <option value="">Todos los estados</option>
                        <option value="pendiente">Pendiente</option>
                        <option value="atendido">Atendido</option>
                    </select>
                    <div class="toolbar-dates">
                        <input id="filtroAvisoDesde" type="date" title="Desde">
                        <input id="filtroAvisoHasta" type="date" title="Hasta">
                    </div>
                    <select id="filtroAvisoOrden">
                        <option value="antiguos">Más antiguos primero</option>
                        <option value="recientes">Más recientes primero</option>
                    </select>
                    <button id="btnLimpiarFiltrosAvisos" type="button" class="btnToolbar">Limpiar</button>
                </div>
                <table id="tablaAvisos">
                    <thead>
                        <tr><th>ID</th><th>Region</th><th>Distrito</th><th>Tipo</th><th>Descripcion</th><th>Estado</th><th>Fecha</th><th>Imagen</th></tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </section>

    <div id="modalReporte" class="modal hidden">
        <div class="modal-content">
            <h3>Reportar problema</h3>
            <label>Tipo de problema</label>
            <select id="inputTipoProblema">
                <option value="falta">Falta señal</option>
                <option value="danada">Señal dañada</option>
                <option value="obstruida">Obstruida</option>
                <option value="otro">Otro</option>
            </select>
            <label>Nombre</label>
            <input type="text" id="inputNombreReporte" placeholder="Nombre y apellido">
            <label>DNI</label>
            <input type="text" id="inputDniReporte" inputmode="numeric" maxlength="8" placeholder="00000000">
            <label>Descripcion</label>
            <textarea id="inputDescripcion" rows="3" placeholder="Describe el problema"></textarea>
            <label>Foto (opcional)</label>
            <input type="file" id="inputFoto" accept="image/*">
            <div class="ubica">
                <span id="infoUbicacion">Haz click en el mapa para fijar la ubicacion.</span>
                <button id="btnElegirMapa" class="btnGhost fullwidth" type="button">Elegir en mapa</button>
            </div>
            <div class="modal-actions">
                <button id="btnCancelarReporte" class="btnGhost">Cancelar</button>
                <button id="btnEnviarReporte">Enviar aviso</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="js/data.js"></script>
    <script src="js/map.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/filters.js"></script>
    <script src="js/events.js"></script>
    <script src="js/reportes.js"></script>
</body>
</html>
