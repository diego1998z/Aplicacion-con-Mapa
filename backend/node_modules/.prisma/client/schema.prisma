generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  passwordHash String
  role         String   @default("user")
  name         String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  reports Report[]
}

model Project {
  id        String    @id @default(cuid())
  legacyId  String?   @unique
  name      String
  year      Int?
  startDate DateTime?
  endDate   DateTime?
  district  String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  assets  Asset[]
  reports Report[]
}

model Plan {
  id        String   @id @default(cuid())
  ownerKey  String
  name      String
  year      Int
  deadline  String?
  status    String
  amount    Float
  executed  Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  projects PlanProject[]
}

model PlanProject {
  id              String   @id @default(cuid())
  planId          String
  projectLegacyId String?
  name            String
  status          String
  assignedAmount  Float
  executedAmount  Float
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  plan Plan @relation(fields: [planId], references: [id])
}

model AnnualBudget {
  id        String   @id @default(cuid())
  ownerKey  String
  year      Int
  total     Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([ownerKey, year])
}

model Asset {
  id            String    @id @default(cuid())
  legacyId      Int?      @unique
  projectId     String?
  type          String
  name          String?
  category      String?
  icon          String?
  state         String?
  statePhysical String?
  lat           Float
  lng           Float
  district      String?
  region        String?
  price         Float?
  installedAt   DateTime?
  width         Float?
  length        Float?
  areaM2        Float?
  photoUrl      String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  project Project? @relation(fields: [projectId], references: [id])
}

model Report {
  id          String   @id @default(cuid())
  legacyId    Int?     @unique
  projectId   String?
  userId      String?
  type        String
  description String?
  status      String?  @default("pendiente")
  lat         Float
  lng         Float
  district    String?
  region      String?
  userName    String?
  userEmail   String?
  userDni     String?
  photoUrl    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  project Project? @relation(fields: [projectId], references: [id])
  user    User?    @relation(fields: [userId], references: [id])
}
